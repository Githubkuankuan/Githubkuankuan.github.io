<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Regular.woff2" as="font">
        <link rel="preload" crossorigin="crossorigin" href="/fonts/roboto/Roboto-Bold.woff2" as="font">
    
    
    
        <link rel="shortcut icon" href="https://z3.ax1x.com/2021/11/29/oM334O.png">
    

    
    
        
<link rel="stylesheet" href="/css/mdui.min.v1.0.0.css">

    
    
<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/iconfont.css">


    
    

    
        <script data-ad-client="ca-" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    












          


    
    
    <title>
        
            react-routerè·¯ç”±åŸç† | KKBlog
        
    </title>
    
    
<meta name="generator" content="Hexo 5.4.2"></head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-teal mdui-theme-accent-blue">
  
  <header class="mdui-appbar mdui-appbar-fixed">
  <div id="toolbar" class="mdui-toolbar mdui-color-theme">
    <button class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="iconfont icon-menu"></i></button>
    <a href="/" class="mdui-typo-headline">KKBlog</a>
    <a href="/" class="header-subtitle mdui-typo-headline"></a>
    <div class="mdui-toolbar-spacer"></div>
    <button class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: 'search'}"><i class="iconfont icon-search"></i></button>
  </div>
</header>

<div class="mdui-dialog" id="search">
  
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="è¯·è¾“å…¥å…³é”®å­—" onfocus="listenSearchFunc()">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
  
</div>

  <aside id="sidebar" class="mdui-drawer">
    <div class="mdui-tab" mdui-tab>
        <a href="#sidebar-tab1" id="sidebartab" class="mdui-ripple mdui-tab-active">ç«™ç‚¹æ¦‚è§ˆ</a>
        <a href="#sidebar-tab2" id="sidebartab" class="mdui-ripple">å…³äº</a>
    </div>

    
    <div id="sidebar-tab1" class="mdui-p-a-1">
        <div class="mdui-list">
            
                
                <a href="/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-home"></i>
                    </div>
                    <div class="mdui-list-item-content">ä¸»é¡µ</div>
                </a>
            
                
                <a href="/tags/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-bookmark"></i>
                    </div>
                    <div class="mdui-list-item-content">æ ‡ç­¾</div>
                </a>
            
                
                <a href="/categories/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-folder"></i>
                    </div>
                    <div class="mdui-list-item-content">åˆ†ç±»</div>
                </a>
            
                
                <a href="/archives/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-archive"></i>
                    </div>
                    <div class="mdui-list-item-content">å½’æ¡£</div>
                </a>
            
                
                <a href="/about/" class="mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-user"></i>
                    </div>
                    <div class="mdui-list-item-content">å…³äº</div>
                </a>
            
            <div class="mdui-list-item mdui-ripple">
                <div class="mdui-list-item-icon">
                    <i class="iconfont icon-moon"></i>
                </div>
                <div class="mdui-list-item-content">å¤œé—´æ¨¡å¼</div>
                <label class="mdui-switch" id="darkmode">
                  <input type="checkbox" id="nightmode_switch"/>
                  <i class="mdui-switch-icon"></i>
                </label>
            </div>           
        </div>
    </div>

    
    <div id="sidebar-tab2" class="mdui-p-a-1">
        <div class="sidebar-overview">
            <div class="sidebar-avatar">
                
                    <img src="https://s3.bmp.ovh/imgs/2021/11/b74ba8f7a70ffeb0.jpg"/>
                
            </div>
            <div class="sidebar-author-name">Dalu Kuankuan</div>
            <div class="sidebar-description">é€‰æ‹©æœ‰æ—¶å€™æ¯”åŠªåŠ›æ›´é‡è¦</div>
        </div>
        <div class="sidebar-links">
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-mail"></i></span>
                    <a href="mailto:zhanglukuan0927@gmail.com" class="mdui-chip-title">E-Mail</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-github"></i></span>
                    <a target="_blank" rel="noopener" href="https://your.url" class="mdui-chip-title">GitHub</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-steam"></i></span>
                    <a target="_blank" rel="noopener" href="https://your.url" class="mdui-chip-title">Steam</a>
                </div>
            
                
                <div class="mdui-chip">
                    <span class="mdui-chip-icon"><i class="iconfont icon-weibo"></i></span>
                    <a target="_blank" rel="noopener" href="https://your.url" class="mdui-chip-title">Weibo</a>
                </div>
            
        </div>
        <ul class="mdui-list" mdui-collapse="{accordion: true}">
            <li class="mdui-collapse-item">
                <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                    <div class="mdui-list-item-icon">
                        <i class="iconfont icon-link"></i>
                    </div>
                    <div class="mdui-list-item-content">å‹æƒ…é“¾æ¥</div>
                    <div class="mdui-collapse-item-arrow">
                        <i class="mdui-list-item-icon iconfont icon-angle-down"></i>
                    </div>
                </div>
                <ul id="linksList" class="mdui-collapse-item-body mdui-list mdui-list-dense">
                    
                        <a target="_blank" rel="noopener" href="https://garybear.cn/hexo-theme-meadow/" class="mdui-list-item mdui-ripple">
                            Meadowè¯´æ˜æ–‡æ¡£
                        </a>
                    
                </ul>
            </li>
        </ul>
    </div>

    <div class="mdui-divider"></div>
    
    
</aside>
  
  <main id="main-contain" class="mdui-container mdui-m-t-5">
    <article id="article" class="mdui-card mdui-p-b-2 mdui-m-b-5">
  <header class="mdui-card-media">
    
    
      <div class="post-header"> 
  <a class="post-header-title" href="/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/">react-routerè·¯ç”±åŸç†</a>
  <div class="post-header-meta">
    <span>
      <span class="iconfont icon-calendar"></span>
      å‘å¸ƒäº:&nbsp;2022-03-22
    </span>
    <span>
      <span class="iconfont icon-calendar-check"></span>
      æ›´æ–°äº:&nbsp;2022-03-22
    </span>
    <span>
      <span class="iconfont icon-folder"></span>
      åˆ†ç±»äº:&nbsp;<a class="category-link" href="/categories/react/">react</a>
    </span>
    
      <span>
        <span class="iconfont icon-eye"></span>
        é˜…è¯»æ¬¡æ•°:&nbsp;
        <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
      </span>
    
  </div>
</div>   
    



    
    
    <div class="mdui-card-menu">
    
      <button class="mdui-btn mdui-btn-icon mdui-text-color-teal" mdui-menu="{target: '#share_menu', align: 'right'}"><i class="iconfont icon-share"></i></button>
      <ul class="mdui-menu" id="share_menu">
        <li class="mdui-menu-item">
          <a href="http://service.weibo.com/share/share.php?appkey=&title=react-routerè·¯ç”±åŸç†&url=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/&pic=http://example.comhttps://z3.ax1x.com/2021/11/29/oM334O.png&searchPic=false&style=simple" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° Weibo</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://twitter.com/intent/tweet?text=react-routerè·¯ç”±åŸç†&url=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/&via=Dalu Kuankuan" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° Twitter</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° Facebook</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://plus.google.com/share?url=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° Google+</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/&title=react-routerè·¯ç”±åŸç†" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° LinkedIn</a>
        </li>
        <li class="mdui-menu-item">
          <a href="http://connect.qq.com/widget/shareqq/index.html?site=KKBlog&title=react-routerè·¯ç”±åŸç†&summary=é€‰æ‹©æœ‰æ—¶å€™æ¯”åŠªåŠ›æ›´é‡è¦&pics=http://example.comhttps://z3.ax1x.com/2021/11/29/oM334O.png&url=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° QQ</a>
        </li>
        <li class="mdui-menu-item">
          <a href="https://telegram.me/share/url?url=http://example.com/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/&text=react-routerè·¯ç”±åŸç†" target="_blank" class="mdui-ripple">åˆ†äº«åˆ° Telegram</a>
        </li>
      </ul>
    
  </div>
  </header>
  
  
  
  
  <div class="post-tags">
    
      <i class="iconfont icon-tag">
        <a rel="tag" href = /tags/react-router%E8%B7%AF%E7%94%B1/ >react-routerè·¯ç”±</a>
      </i>
    
  </div>

  
  <div class="mdui-card-content mdui-typo mdui-p-x-4">
    <h1 id="ä¸€ã€æ­£ç¡®ç†è§£react-router"><a href="#ä¸€ã€æ­£ç¡®ç†è§£react-router" class="headerlink" title="ä¸€ã€æ­£ç¡®ç†è§£react-router"></a>ä¸€ã€æ­£ç¡®ç†è§£react-router</h1><h2 id="1-ç†è§£å•é¡µé¢åº”ç”¨"><a href="#1-ç†è§£å•é¡µé¢åº”ç”¨" class="headerlink" title="1. ç†è§£å•é¡µé¢åº”ç”¨"></a>1. ç†è§£å•é¡µé¢åº”ç”¨</h2><p><strong>ä»€ä¹ˆæ˜¯å•é¡µé¢åº”ç”¨ï¼Ÿ</strong><br>ä¸ªäººç†è§£ï¼Œå•é¡µé¢åº”ç”¨æ˜¯ä½¿ç”¨ä¸€ä¸ªhtmlä¸‹ï¼Œä¸€æ¬¡æ€§åŠ è½½jsï¼Œcssç­‰èµ„æºï¼Œæ‰€æœ‰é¡µé¢éƒ½åœ¨ä¸€ä¸ªå®¹å™¨é¡µé¢ä¸‹ï¼Œé¡µé¢åˆ‡æ¢å®è´¨æ˜¯ç»„ä»¶çš„åˆ‡æ¢ã€‚</p>
<p><img src="/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/img.png"></p>
<h2 id="2-react-routeråˆæ¢ï¼Œæ­éœ²è·¯ç”±åŸç†é¢çº±"><a href="#2-react-routeråˆæ¢ï¼Œæ­éœ²è·¯ç”±åŸç†é¢çº±" class="headerlink" title="2. react-routeråˆæ¢ï¼Œæ­éœ²è·¯ç”±åŸç†é¢çº±"></a>2. react-routeråˆæ¢ï¼Œæ­éœ²è·¯ç”±åŸç†é¢çº±</h2><p><strong>â‘  react-router-domå’Œreact-routerå’Œhistoryåº“ä¸‰è€…ä»€ä¹ˆå…³ç³»</strong><br>historyå¯ä»¥ç†è§£ä¸ºreact-routerçš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æ•´ä¸ªè·¯ç”±åŸç†çš„æ ¸å¿ƒï¼Œé‡Œå–å¼„ç»§æ‰¿äº† popstateï¼Œhistory.pushStateç­‰åº•å±‚è·¯ç”±å®ç°çš„åŸç†æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä¸€ä¸€è§£é‡Šã€‚<br>react-routerå¯ä»¥ç†è§£ä¸ºæ˜¯react-router-domçš„æ ¸å¿ƒï¼Œé‡Œé¢å°è£…äº†Routerï¼ŒRouteï¼ŒSwitchç­‰æ ¸å¿ƒç»„ä»¶,å®ç°äº†ä»è·¯ç”±çš„æ”¹å˜åˆ°ç»„ä»¶çš„æ›´æ–°çš„æ ¸å¿ƒåŠŸèƒ½,åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åªè¦ä¸€æ¬¡æ€§å¼•å…¥react-router-domå°±å¯ä»¥äº†ã€‚<br>react-router-dom,åœ¨react-routerçš„æ ¸å¿ƒåŸºç¡€ä¸Šï¼Œæ·»åŠ äº†ç”¨äºè·³è½¬çš„Linkç»„ä»¶ï¼Œå’Œhistoryæ¨¡å¼ä¸‹çš„BrowserRouterå’Œhashæ¨¡å¼ä¸‹çš„HashRouterç»„ä»¶ç­‰ã€‚æ‰€è°“BrowserRouterå’ŒHashRouterï¼Œä¹Ÿåªä¸è¿‡ç”¨äº†historyåº“ä¸­createBrowserHistoryå’ŒcreateHashHistoryæ–¹æ³•<br>react-router-dom æˆ‘ä»¬ä¸å¤šè¯´äº†ï¼Œè¿™é‡Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹react-routerã€‚</p>
<p><strong>â‘¡æ¥ä¸ªå°demoå°å°é²œ?</strong></p>
<pre><code class="js">import &#123; BrowserRouter as Router, Switch, Route, Redirect,Link &#125; from &#39;react-router-dom&#39;

import Detail from &#39;../src/page/detail&#39;
import List from &#39;../src/page/list&#39;
import Index from &#39;../src/page/home/index&#39;

const menusList = [
  &#123;
    name: &#39;é¦–é¡µ&#39;,
    path: &#39;/index&#39;
  &#125;,
  &#123;
    name: &#39;åˆ—è¡¨&#39;,
    path: &#39;/list&#39;
  &#125;,
  &#123;
    name: &#39;è¯¦æƒ…&#39;,
    path: &#39;/detail&#39;
  &#125;,
]
const index = () =&gt; &#123;
  return &lt;div &gt;
    &lt;div &gt;
     
      &lt;Router  &gt;
      &lt;div&gt;&#123;
        /* link è·¯ç”±è·³è½¬ */
         menusList.map(router=&gt;&lt;Link key=&#123;router.path&#125; to=&#123; router.path &#125; &gt;
           &lt;span className=&quot;routerLink&quot; &gt;&#123;router.name&#125;&lt;/span&gt;
         &lt;/Link&gt;)
      &#125;&lt;/div&gt;
        &lt;Switch&gt;
          &lt;Route path=&#123;&#39;/index&#39;&#125; component=&#123;Index&#125; &gt;&lt;/Route&gt;
          &lt;Route path=&#123;&#39;/list&#39;&#125; component=&#123;List&#125; &gt;&lt;/Route&gt;
          &lt;Route path=&#123;&#39;/detail&#39;&#125; component=&#123;Detail&#125; &gt;&lt;/Route&gt;
          &#123;/*  è·¯ç”±ä¸åŒ¹é…ï¼Œé‡å®šå‘åˆ°/index  */&#125;
          &lt;Redirect from=&#39;/*&#39; to=&#39;/index&#39; /&gt;
        &lt;/Switch&gt;
      &lt;/Router&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&#125;
</code></pre>
<p><strong>æ•ˆæœå¦‚ä¸‹</strong><br><img src="https://img-blog.csdnimg.cn/img_convert/08f57d33419dbf8917460d531662c9d9.png"></p>
<h1 id="äºŒã€å•é¡µé¢å®ç°æ ¸å¿ƒåŸç†"><a href="#äºŒã€å•é¡µé¢å®ç°æ ¸å¿ƒåŸç†" class="headerlink" title="äºŒã€å•é¡µé¢å®ç°æ ¸å¿ƒåŸç†"></a>äºŒã€å•é¡µé¢å®ç°æ ¸å¿ƒåŸç†</h1><p>å•é¡µé¢åº”ç”¨è·¯ç”±å®ç°åŸç†æ˜¯ï¼Œåˆ‡æ¢urlï¼Œç›‘å¬urlå˜åŒ–ï¼Œä»è€Œæ¸²æŸ“ä¸åŒçš„é¡µé¢ç»„ä»¶ã€‚<br>ä¸»è¦çš„æ–¹å¼historyæ¨¡å¼å’Œhashæ¨¡å¼ã€‚</p>
<h2 id="1-historyæ¨¡å¼åŸç†"><a href="#1-historyæ¨¡å¼åŸç†" class="headerlink" title="1. historyæ¨¡å¼åŸç†"></a>1. historyæ¨¡å¼åŸç†</h2><p><strong>â‘  æ”¹å˜è·¯ç”±</strong><br><code>history.pushState</code></p>
<pre><code class="js">history.pushState(state,title,path)
</code></pre>
<ol>
<li><code>state</code>ï¼šä¸€ä¸ªä¸æŒ‡å®šç½‘å€ç›¸å…³çš„çŠ¶æ€å¯¹è±¡ï¼Œpopstateäº‹ä»¶è§¦å‘æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šä¼ å…¥å›è°ƒå‡½æ•°ã€‚å¦‚æœä¸éœ€è¦å¯å¡«nullã€‚</li>
<li>titleï¼šæ–°é¡µé¢çš„æ ‡é¢˜ï¼Œä½†æ˜¯æ‰€æœ‰æµè§ˆå™¨ç›®å‰éƒ½å¿½ç•¥è¿™ä¸ªå€¼ï¼Œå¯å¡«nullã€‚</li>
<li>pathï¼šæ–°çš„ç½‘å€ï¼Œå¿…é¡»ä¸å½“å‰é¡µé¢å¤„äºåŒä¸€ä¸ªåŸŸã€‚æµè§ˆå™¨çš„åœ°å€å°†æ˜¾ç¤ºè¿™ä¸ªåœ°å€ã€‚</li>
</ol>
<p><code>history.replaceState</code></p>
<pre><code class="js">history.replaceState(state,title,path)
</code></pre>
<p>å‚æ•°å’ŒpushStateä¸€æ ·ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¿®æ”¹å½“å‰çš„ history å¯¹è±¡è®°å½•ï¼Œ history.length çš„é•¿åº¦ä¸ä¼šæ”¹å˜ã€‚<br><strong>â‘¡ ç›‘å¬è·¯ç”±</strong><br><code>popstateäº‹ä»¶</code></p>
<pre><code class="js">window.addEventListener(&#39;popstate&#39;,function(e)&#123;
    /* ç›‘å¬æ”¹å˜ */
&#125;)
</code></pre>
<p>åŒä¸€ä¸ªæ–‡æ¡£çš„ history å¯¹è±¡å‡ºç°å˜åŒ–æ—¶ï¼Œå°±ä¼šè§¦å‘ popstate äº‹ä»¶<br>history.pushState å¯ä»¥ä½¿æµè§ˆå™¨åœ°å€æ”¹å˜ï¼Œä½†æ˜¯æ— éœ€åˆ·æ–°é¡µé¢ã€‚æ³¨æ„ âš ï¸çš„æ˜¯ï¼šç”¨ history.pushState() æˆ–è€… history.replaceState() ä¸ä¼šè§¦å‘ popstate äº‹ä»¶ã€‚ popstate äº‹ä»¶åªä¼šåœ¨æµè§ˆå™¨æŸäº›è¡Œä¸ºä¸‹è§¦å‘, æ¯”å¦‚ç‚¹å‡»åé€€ã€å‰è¿›æŒ‰é’®æˆ–è€…è°ƒç”¨ history.back()ã€history.forward()ã€history.go()æ–¹æ³•ã€‚</p>
<h2 id="2-hashæ¨¡å¼åŸç†"><a href="#2-hashæ¨¡å¼åŸç†" class="headerlink" title="2. hashæ¨¡å¼åŸç†"></a>2. hashæ¨¡å¼åŸç†</h2><p><strong>â‘  æ”¹å˜è·¯ç”±</strong><br><code>window.location.hash</code><br>é€šè¿‡window.location.hash å±æ€§è·å–å’Œè®¾ç½® hash å€¼ã€‚</p>
<p><strong>â‘¡ ç›‘å¬è·¯ç”±</strong><br><code>onhashchange</code></p>
<pre><code class="js">window.addEventListener(&#39;hashchange&#39;,function(e)&#123;
    /* ç›‘å¬æ”¹å˜ */
&#125;)
</code></pre>
<h1 id="ä¸‰ã€ç†è§£-history-åº“"><a href="#ä¸‰ã€ç†è§£-history-åº“" class="headerlink" title="ä¸‰ã€ç†è§£ history åº“"></a>ä¸‰ã€ç†è§£ history åº“</h1><p>react-routerè·¯ç”±ç¦»ä¸å¼€historyåº“ï¼Œhistoryä¸“æ³¨äºè®°å½•è·¯ç”±historyçŠ¶æ€ï¼Œä»¥åŠpathæ”¹å˜äº†ï¼Œæˆ‘ä»¬åº”è¯¥åšå†™ä»€ä¹ˆã€‚<br>åœ¨historyæ¨¡å¼ä¸‹ç”¨popstateç›‘å¬è·¯ç”±å˜åŒ–ï¼Œåœ¨hashæ¨¡å¼ä¸‹ç”¨hashchangeç›‘å¬è·¯ç”±çš„å˜åŒ–ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ Browseræ¨¡å¼ä¸‹çš„createBrowserHistory å’Œ Hashæ¨¡å¼ä¸‹çš„ createHashHistoryæ–¹æ³•ã€‚</p>
<h3 id="1-createBrowserHistory"><a href="#1-createBrowserHistory" class="headerlink" title="1. createBrowserHistory"></a>1. createBrowserHistory</h3><p>Browseræ¨¡å¼ä¸‹è·¯ç”±çš„è¿è¡Œ ï¼Œä¸€åˆ‡éƒ½ä»createBrowserHistoryå¼€å§‹ã€‚è¿™é‡Œæˆ‘ä»¬å‚è€ƒçš„history-4.7.2ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸­apiå¯èƒ½æœ‰äº›å‡ºå…¥ï¼Œä½†æ˜¯åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåœ¨è§£æhistoryè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨setState ,push ,handlePopState,listenæ–¹æ³•</p>
<pre><code class="js">const PopStateEvent = &#39;popstate&#39;
const HashChangeEvent = &#39;hashchange&#39;
/* è¿™é‡Œç®€åŒ–äº†createBrowserHistoryï¼Œåˆ—å‡ºäº†å‡ ä¸ªæ ¸å¿ƒapiåŠå…¶ä½œç”¨ */
function createBrowserHistory()&#123;
    /* å…¨å±€history  */
    const globalHistory = window.history
    /* å¤„ç†è·¯ç”±è½¬æ¢ï¼Œè®°å½•äº†listensä¿¡æ¯ã€‚ */
    const transitionManager = createTransitionManager()
    /* æ”¹å˜locationå¯¹è±¡ï¼Œé€šçŸ¥ç»„ä»¶æ›´æ–° */
    const setState = () =&gt; &#123; /* ... */ &#125;
    
    /* å¤„ç†å½“pathæ”¹å˜åï¼Œå¤„ç†popstateå˜åŒ–çš„å›è°ƒå‡½æ•° */
    const handlePopState = () =&gt; &#123; /* ... */ &#125;
   
    /* history.pushæ–¹æ³•ï¼Œæ”¹å˜è·¯ç”±ï¼Œé€šè¿‡å…¨å±€å¯¹è±¡history.pushStateæ”¹å˜url, é€šçŸ¥routerè§¦å‘æ›´æ–°ï¼Œæ›¿æ¢ç»„ä»¶ */
    const push=() =&gt; &#123; /*...*/ &#125;
    
    /* åº•å±‚åº”ç”¨äº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬popstateäº‹ä»¶ */
    const listen=()=&gt;&#123; /*...*/ &#125; 
    return &#123;
       push,
       listen,
       /* .... */ 
    &#125;
&#125;
</code></pre>
<p>ä¸‹é¢é€ä¸€åˆ†æå„ä¸ªapi,å’Œä»–ä»¬ä¹‹å‰çš„ç›¸äº’ä½œç”¨</p>
<pre><code class="js">const PopStateEvent = &#39;popstate&#39;
const HashChangeEvent = &#39;hashchange&#39;
</code></pre>
<p><code>popstate</code> å’Œ <code>hashchange</code> æ˜¯ç›‘å¬è·¯ç”±å˜åŒ–åº•å±‚æ–¹æ³•ã€‚</p>
<p><strong>â‘  setState</strong></p>
<pre><code class="js">const setState = (nextState) =&gt; &#123;
    /* åˆå¹¶ä¿¡æ¯ */
    Object.assign(history, nextState)
    history.length = globalHistory.length
    /* é€šçŸ¥æ¯ä¸€ä¸ªlistens è·¯ç”±å·²ç»å‘ç”Ÿå˜åŒ– */
    transitionManager.notifyListeners(
      history.location,
      history.action
    )
  &#125;
</code></pre>
<p>ä»£ç å¾ˆç®€å•ï¼šç»Ÿä¸€æ¯ä¸ªtransitionManagerç®¡ç†çš„listenerè·¯ç”±çŠ¶æ€å·²ç»æ›´æ–°ã€‚<br>ä»€ä¹ˆæ—¶å€™ç»‘å®šlistenerï¼Œ æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„React-Routerä»£ç ä¸­ä¼šä»‹ç»ã€‚</p>
<p><strong>â‘¡ listen</strong></p>
<pre><code class="js">const listen = (listener) =&gt; &#123;
    /* æ·»åŠ listen */
    const unlisten = transitionManager.appendListener(listener)
    checkDOMListeners(1)

    return () =&gt; &#123;
      checkDOMListeners(-1)
      unlisten()
    &#125;
&#125;
</code></pre>
<p><strong>checkDOMListeners</strong></p>
<pre><code class="js">const checkDOMListeners = (delta) =&gt; &#123;
    listenerCount += delta
    if (listenerCount === 1) &#123;
      addEventListener(window, PopStateEvent, handlePopState)
      if (needsHashChangeListener)
        addEventListener(window, HashChangeEvent, handleHashChange)
    &#125; else if (listenerCount === 0) &#123;
      removeEventListener(window, PopStateEvent, handlePopState)
      if (needsHashChangeListener)
        removeEventListener(window, HashChangeEvent, handleHashChange)
    &#125;
  &#125;
</code></pre>
<p>listenæœ¬è´¨é€šè¿‡checkDOMListenersçš„å‚æ•° 1 æˆ– -1 æ¥ç»‘å®š/è§£ç»‘ popstate äº‹ä»¶ï¼Œå½“è·¯ç”±å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œè°ƒç”¨å¤„ç†å‡½æ•°handlePopStateã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹pushæ–¹æ³•ã€‚</p>
<p><strong>â‘¢ push</strong></p>
<pre><code class="js"> const push = (path, state) =&gt; &#123;
    const action = &#39;PUSH&#39;
    /* 1 åˆ›å»ºlocationå¯¹è±¡ */
    const location = createLocation(path, state, createKey(), history.location)
    /* ç¡®å®šæ˜¯å¦èƒ½è¿›è¡Œè·¯ç”±è½¬æ¢ï¼Œè¿˜åœ¨ç¡®è®¤çš„æ—¶å€™åˆå¼€å§‹äº†å¦ä¸€ä¸ªè½¬å˜ ,å¯èƒ½ä¼šé€ æˆå¼‚å¸¸ */
    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, (ok) =&gt; &#123;
      if (!ok)
        return
      const href = createHref(location)
      const &#123; key, state &#125; = location
      if (canUseHistory) &#123;
        /* æ”¹å˜ url */
        globalHistory.pushState(&#123; key, state &#125;, null, href)
        if (forceRefresh) &#123;
          window.location.href = href
        &#125; else &#123;
          /* æ”¹å˜ react-router locationå¯¹è±¡, åˆ›å»ºæ›´æ–°ç¯å¢ƒ */
          setState(&#123; action, location &#125;)
        &#125;
      &#125; else &#123;
        window.location.href = href
      &#125;
    &#125;)
  &#125;
</code></pre>
<p>push ( history.push ) æµç¨‹å¤§è‡´æ˜¯ é¦–å…ˆç”Ÿæˆä¸€ä¸ªæœ€æ–°çš„locationå¯¹è±¡ï¼Œç„¶åé€šè¿‡window.history.pushStateæ–¹æ³•æ”¹å˜æµè§ˆå™¨å½“å‰è·¯ç”±(å³å½“å‰çš„path),æœ€åé€šè¿‡setStateæ–¹æ³•é€šçŸ¥React-Routeræ›´æ–°ï¼Œå¹¶ä¼ é€’å½“å‰çš„locationå¯¹è±¡ï¼Œç”±äºè¿™æ¬¡urlå˜åŒ–çš„ï¼Œæ˜¯history.pushStateäº§ç”Ÿçš„ï¼Œå¹¶ä¸ä¼šè§¦å‘popStateæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨setStateï¼Œè§¦å‘ç»„ä»¶æ›´æ–°ã€‚</p>
<p><strong>â‘£ handlePopState</strong></p>
<pre><code class="js">/* æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹handlePopState */
const handlePopState = (event)=&gt;&#123;
     /* è·å–å½“å‰locationå¯¹è±¡ */
    const location = getDOMLocation(event.state)
    const action = &#39;POP&#39;

    transitionManager.confirmTransitionTo(location, action, getUserConfirmation, (ok) =&gt; &#123;
        if (ok) &#123;
          setState(&#123; action, location &#125;)
        &#125; else &#123;
          revertPop(location)
        &#125;
    &#125;)
&#125;
</code></pre>
<p>handlePopState ä»£ç å¾ˆç®€å• ï¼Œåˆ¤æ–­ä¸€ä¸‹actionç±»å‹ä¸ºpop,ç„¶å setState ï¼Œä»æ–°åŠ è½½ç»„ä»¶ã€‚</p>
<h3 id="2-createHashHistory"><a href="#2-createHashHistory" class="headerlink" title="2. createHashHistory"></a>2. createHashHistory</h3><p>hash æ¨¡å¼å’Œ history APIç±»ä¼¼ï¼Œæˆ‘ä»¬é‡ç‚¹è®²ä¸€ä¸‹ hashæ¨¡å¼ä¸‹ï¼Œæ€ä¹ˆç›‘å¬è·¯ç”±ï¼Œå’Œpush , replaceæ–¹æ³•æ˜¯æ€ä¹ˆæ”¹å˜æ”¹å˜è·¯å¾„çš„ã€‚<br><strong>ç›‘å¬å“ˆå¸Œè·¯ç”±å˜åŒ–</strong></p>
<pre><code class="js">  const HashChangeEvent = &#39;hashchange&#39;
  const checkDOMListeners = (delta) =&gt; &#123;
    listenerCount += delta
    if (listenerCount === 1) &#123;
      addEventListener(window, HashChangeEvent, handleHashChange)
    &#125; else if (listenerCount === 0) &#123;
      removeEventListener(window, HashChangeEvent, handleHashChange)
    &#125;
  &#125;
</code></pre>
<p>å’Œä¹‹å‰æ‰€è¯´çš„ä¸€æ ·ï¼Œå°±æ˜¯ç”¨hashchangeæ¥ç›‘å¬hashè·¯ç”±çš„å˜åŒ–ã€‚</p>
<p><strong>æ”¹å˜å“ˆå¸Œè·¯ç”±</strong></p>
<pre><code class="js">/* å¯¹åº” push æ–¹æ³• */
const pushHashPath = (path) =&gt;
  window.location.hash = path

/* å¯¹åº”replaceæ–¹æ³• */
const replaceHashPath = (path) =&gt; &#123;
  const hashIndex = window.location.href.indexOf(&#39;#&#39;)

  window.location.replace(
    window.location.href.slice(0, hashIndex &gt;= 0 ? hashIndex : 0) + &#39;#&#39; + path
  )
&#125;
</code></pre>
<p>åœ¨hashæ¨¡å¼ä¸‹ ï¼Œhistory.push åº•å±‚æ˜¯è°ƒç”¨äº†window.location.hrefæ¥æ”¹å˜è·¯ç”±ã€‚history.replaceåº•å±‚æ˜¯æ‰ç”¨<br>window.location.replaceæ”¹å˜è·¯ç”±ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>æˆ‘ä»¬ç”¨ä¸€å¹…å›¾æ¥æè¿°äº†ä¸€ä¸‹historyåº“æ•´ä½“æµç¨‹ã€‚</strong></p>
<p><img src="/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/img_1.png"></p>
<h1 id="å››ã€-æ ¸å¿ƒapi"><a href="#å››ã€-æ ¸å¿ƒapi" class="headerlink" title="å››ã€ æ ¸å¿ƒapi"></a>å››ã€ æ ¸å¿ƒapi</h1><h2 id="1ã€Router-æ¥æ”¶locationå˜åŒ–ï¼Œæ´¾å‘æ›´æ–°æµ"><a href="#1ã€Router-æ¥æ”¶locationå˜åŒ–ï¼Œæ´¾å‘æ›´æ–°æµ" class="headerlink" title="1ã€Router-æ¥æ”¶locationå˜åŒ–ï¼Œæ´¾å‘æ›´æ–°æµ"></a>1ã€Router-æ¥æ”¶locationå˜åŒ–ï¼Œæ´¾å‘æ›´æ–°æµ</h2><p>Router ä½œç”¨æ˜¯æŠŠ history location ç­‰è·¯ç”±ä¿¡æ¯ ä¼ é€’ä¸‹å»<br><code>Router</code></p>
<pre><code class="js">/* Router ä½œç”¨æ˜¯æŠŠ history location ç­‰è·¯ç”±ä¿¡æ¯ ä¼ é€’ä¸‹å»  */
class Router extends React.Component &#123;
  static computeRootMatch(pathname) &#123;
    return &#123; path: &#39;/&#39;, url: &#39;/&#39;, params: &#123;&#125;, isExact: pathname === &#39;/&#39; &#125;;
  &#125;
  constructor(props) &#123;
    super(props);
    this.state = &#123;
      location: props.history.location
    &#125;;
    //è®°å½•pendingä½ç½®
    //å¦‚æœå­˜åœ¨ä»»ä½•&lt;Redirect&gt;ï¼Œåˆ™åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œæ›´æ”¹
    //åœ¨åˆå§‹æ¸²æŸ“æ—¶ã€‚å¦‚æœæœ‰ï¼Œå®ƒä»¬å°†åœ¨
    //åœ¨å­ç»„ä»¶èº«ä¸Šæ¿€æ´»ï¼Œæˆ‘ä»¬å¯èƒ½ä¼š
    //åœ¨å®‰è£…&lt;Router&gt;ä¹‹å‰è·å–ä¸€ä¸ªæ–°ä½ç½®ã€‚
    this._isMounted = false;
    this._pendingLocation = null;
    /* æ­¤æ—¶çš„historyï¼Œæ˜¯historyåˆ›å»ºçš„historyå¯¹è±¡ */
    if (!props.staticContext) &#123;
      /* è¿™é‡Œåˆ¤æ–­ componentDidMount å’Œ history.listen æ‰§è¡Œé¡ºåº ç„¶åæŠŠ locationå¤åˆ¶ ï¼Œé˜²æ­¢ç»„ä»¶é‡æ–°æ¸²æŸ“ */
      this.unlisten = props.history.listen(location =&gt; &#123;
        /* åˆ›å»ºç›‘å¬è€… */
        if (this._isMounted) &#123;

          this.setState(&#123; location &#125;);
        &#125; else &#123;
          this._pendingLocation = location;
        &#125;
      &#125;);
    &#125;
  &#125;
  componentDidMount() &#123;
    this._isMounted = true;
    if (this._pendingLocation) &#123;
      this.setState(&#123; location: this._pendingLocation &#125;);
    &#125;
  &#125;
  componentWillUnmount() &#123;
    /* è§£é™¤ç›‘å¬ */
    if (this.unlisten) this.unlisten();
  &#125;
  render() &#123;
    return (
      /*  è¿™é‡Œå¯ä»¥ç†è§£ react.createContext åˆ›å»ºä¸€ä¸ª contextä¸Šä¸‹æ–‡ ï¼Œä¿å­˜routeråŸºæœ¬ä¿¡æ¯ã€‚children */
      &lt;RouterContext.Provider
          children=&#123;this.props.children || null&#125;
          value=&#123;&#123;
          history: this.props.history,
          location: this.state.location,
          match: Router.computeRootMatch(this.state.location.pathname),
          staticContext: this.props.staticContext
        &#125;&#125;
      /&gt;
    );
  &#125;
&#125;
</code></pre>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>åˆå§‹åŒ–ç»‘å®šlisten, è·¯ç”±å˜åŒ–,é€šçŸ¥æ”¹å˜location,æ”¹å˜ç»„ä»¶ã€‚ reactçš„historyè·¯ç”±çŠ¶æ€æ˜¯ä¿å­˜åœ¨React.Contentä¸Šä¸‹æ–‡ä¹‹é—´, çŠ¶æ€æ›´æ–°ã€‚<br>ä¸€ä¸ªé¡¹ç›®åº”è¯¥æœ‰ä¸€ä¸ªæ ¹Router ï¼Œ æ¥äº§ç”Ÿåˆ‡æ¢è·¯ç”±ç»„ä»¶ä¹‹å‰çš„æ›´æ–°ä½œç”¨ã€‚<br>å¦‚æœå­˜åœ¨å¤šä¸ªRouterä¼šé€ æˆï¼Œä¼šé€ æˆåˆ‡æ¢è·¯ç”±ï¼Œé¡µé¢ä¸æ›´æ–°çš„æƒ…å†µã€‚</p>
<h2 id="2ã€Switch-åŒ¹é…æ­£ç¡®çš„å”¯ä¸€çš„è·¯ç”±"><a href="#2ã€Switch-åŒ¹é…æ­£ç¡®çš„å”¯ä¸€çš„è·¯ç”±" class="headerlink" title="2ã€Switch-åŒ¹é…æ­£ç¡®çš„å”¯ä¸€çš„è·¯ç”±"></a>2ã€Switch-åŒ¹é…æ­£ç¡®çš„å”¯ä¸€çš„è·¯ç”±</h2><p>æ ¹æ®routeræ›´æ–°æµï¼Œæ¥æ¸²æŸ“å½“å‰ç»„ä»¶ã€‚</p>
<pre><code class="js">/* switchç»„ä»¶ */
class Switch extends React.Component &#123;
  render() &#123;
    return (
      &lt;RouterContext.Consumer&gt;
        &#123;/* å«æœ‰ history location å¯¹è±¡çš„ context */&#125;
        &#123;context =&gt; &#123;
          invariant(context, &#39;You should not use &lt;Switch&gt; outside a &lt;Router&gt;&#39;);
          const location = this.props.location || context.location;
          let element, match;
          //æˆ‘ä»¬ä½¿ç”¨React.Children.forEachè€Œä¸æ˜¯React.Children.toArrayï¼ˆï¼‰.findï¼ˆï¼‰
          //è¿™é‡Œæ˜¯å› ä¸ºtoArrayå‘æ‰€æœ‰å­å…ƒç´ æ·»åŠ äº†é”®ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›
          //ä¸ºå‘ˆç°ç›¸åŒçš„ä¸¤ä¸ª&lt;Route&gt;sè§¦å‘å¸è½½/é‡æ–°è£…è½½
          //ç»„ä»¶ä½äºä¸åŒçš„URLã€‚
          //è¿™é‡Œåªéœ€ç„¶ç¬¬ä¸€ä¸ª å«æœ‰ match === null çš„ç»„ä»¶
          React.Children.forEach(this.props.children, child =&gt; &#123;
            if (match == null &amp;&amp; React.isValidElement(child)) &#123;
              element = child;
              // å­ç»„ä»¶ ä¹Ÿå°±æ˜¯ è·å– Routeä¸­çš„ path æˆ–è€… rediect çš„ from
              const path = child.props.path || child.props.from;
              match = path
                ? matchPath(location.pathname, &#123; ...child.props, path &#125;)
                : context.match;
            &#125;
          &#125;);
          return match
            ? React.cloneElement(element, &#123; location, computedMatch: match &#125;)
            : null;
        &#125;&#125;
      &lt;/RouterContext.Consumer&gt;
    );
  &#125;
&#125;
</code></pre>
<p>æ‰¾åˆ°ä¸å½“å‰path,åŒ¹é…çš„ç»„ä»¶è¿›è¡Œæ¸²æŸ“ã€‚ é€šè¿‡pathnameå’Œç»„ä»¶çš„pathè¿›è¡ŒåŒ¹é…ã€‚æ‰¾åˆ°ç¬¦åˆpathçš„routerç»„ä»¶ã€‚<br><strong>matchPath</strong></p>
<pre><code class="js">function matchPath(pathname, options = &#123;&#125;) &#123;
  if (typeof options === &quot;string&quot; || Array.isArray(options)) &#123;
    options = &#123; path: options &#125;;
  &#125;

  const &#123; path, exact = false, strict = false, sensitive = false &#125; = options;

  const paths = [].concat(path);

  return paths.reduce((matched, path) =&gt; &#123;
    if (!path &amp;&amp; path !== &quot;&quot;) return null;
    if (matched) return matched;

    const &#123; regexp, keys &#125; = compilePath(path, &#123;
      end: exact,
      strict,
      sensitive
    &#125;);
    const match = regexp.exec(pathname);
    /* åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›null */
    if (!match) return null;

    const [url, ...values] = match;
    const isExact = pathname === url;

    if (exact &amp;&amp; !isExact) return null;

    return &#123;
      path, // the path used to match
      url: path === &quot;/&quot; &amp;&amp; url === &quot;&quot; ? &quot;/&quot; : url, // the matched portion of the URL
      isExact, // whether or not we matched exactly
      params: keys.reduce((memo, key, index) =&gt; &#123;
        memo[key.name] = values[index];
        return memo;
      &#125;, &#123;&#125;)
    &#125;;
  &#125;, null);
&#125;
</code></pre>
<h2 id="3ã€Route-ç»„ä»¶é¡µé¢æ‰¿è½½å®¹å™¨"><a href="#3ã€Route-ç»„ä»¶é¡µé¢æ‰¿è½½å®¹å™¨" class="headerlink" title="3ã€Route-ç»„ä»¶é¡µé¢æ‰¿è½½å®¹å™¨"></a>3ã€Route-ç»„ä»¶é¡µé¢æ‰¿è½½å®¹å™¨</h2><pre><code class="js">/**
 * The public API for matching a single path and rendering.
 */
class Route extends React.Component &#123;
  render() &#123;
    return (
      &lt;RouterContext.Consumer&gt;
        &#123;context =&gt; &#123;
          /* router / route ä¼šç»™äºˆè­¦å‘Šè­¦å‘Š */
          invariant(context, &quot;You should not use &lt;Route&gt; outside a &lt;Router&gt;&quot;);
          // computedMatch ä¸º ç»è¿‡ swichå¤„ç†åçš„ path
          const location = this.props.location || context.location;
          const match = this.props.computedMatch 
            ? this.props.computedMatch // &lt;Switch&gt; already computed the match for us
            : this.props.path
            ? matchPath(location.pathname, this.props)
            : context.match;
          const props = &#123; ...context, location, match &#125;;
          let &#123; children, component, render &#125; = this.props;

          if (Array.isArray(children) &amp;&amp; children.length === 0) &#123;
            children = null;
          &#125;

          return (
            &lt;RouterContext.Provider value=&#123;props&#125;&gt;
              &#123;props.match
                ? children
                  ? typeof children === &quot;function&quot;
                    ? __DEV__
                      ? evalChildrenDev(children, props, this.props.path)
                      : children(props)
                    : children
                  : component
                  ? React.createElement(component, props)
                  : render
                  ? render(props)
                  : null
                : typeof children === &quot;function&quot;
                ? __DEV__
                  ? evalChildrenDev(children, props, this.props.path)
                  : children(props)
                : null&#125;
            &lt;/RouterContext.Provider&gt;
          );
        &#125;&#125;
      &lt;/RouterContext.Consumer&gt;
    );
  &#125;
&#125;
</code></pre>
<p>åŒ¹é…path,æ¸²æŸ“ç»„ä»¶ã€‚ä½œä¸ºè·¯ç”±ç»„ä»¶çš„å®¹å™¨,å¯ä»¥æ ¹æ®å°†å®é™…çš„ç»„ä»¶æ¸²æŸ“å‡ºæ¥ã€‚é€šè¿‡RouterContext.Consume å–å‡ºå½“å‰ä¸Šä¸€çº§çš„location,matchç­‰ä¿¡æ¯ã€‚ä½œä¸ºpropä¼ é€’ç»™é¡µé¢ç»„ä»¶ã€‚ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢ç»„ä»¶ä¸­çš„propsä¸­è·å–location ,matchç­‰ä¿¡æ¯ã€‚</p>
<h2 id="4ã€Redirect-æ²¡æœ‰ç¬¦åˆçš„è·¯ç”±ï¼Œé‚£ä¹ˆé‡å®šå‘"><a href="#4ã€Redirect-æ²¡æœ‰ç¬¦åˆçš„è·¯ç”±ï¼Œé‚£ä¹ˆé‡å®šå‘" class="headerlink" title="4ã€Redirect-æ²¡æœ‰ç¬¦åˆçš„è·¯ç”±ï¼Œé‚£ä¹ˆé‡å®šå‘"></a>4ã€Redirect-æ²¡æœ‰ç¬¦åˆçš„è·¯ç”±ï¼Œé‚£ä¹ˆé‡å®šå‘</h2><p>é‡å®šå‘ç»„ä»¶ï¼Œ å¦‚æœæ¥è·¯ç”±åŒ¹é…ä¸Šï¼Œä¼šé‡å®šå‘å¯¹åº”çš„è·¯ç”±ã€‚</p>
<pre><code class="js">function Redirect(&#123; computedMatch, to, push = false &#125;) &#123;
  return (
    &lt;RouterContext.Consumer&gt;
      &#123;context =&gt; &#123;
        const &#123; history, staticContext &#125; = context;
        /* methodå°±æ˜¯è·¯ç”±è·³è½¬æ–¹æ³•ã€‚ */
        const method = push ? history.push : history.replace;
        /* æ‰¾åˆ°ç¬¦åˆmatchçš„location ï¼Œæ ¼å¼åŒ–location */
        const location = createLocation(
          computedMatch
            ? typeof to === &#39;string&#39;
              ? generatePath(to, computedMatch.params)
              : &#123;
                  ...to,
                  pathname: generatePath(to.pathname, computedMatch.params)
                &#125;
            : to
        )
        /* åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œè·¯ç”±è·³è½¬ï¼Œå½“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œmountedæ‰§è¡Œpushæ–¹æ³•ï¼Œå½“ç»„ä»¶æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚æœlocationä¸ç›¸ç­‰ã€‚åŒæ ·ä¼šæ‰§è¡Œhistoryæ–¹æ³•é‡å®šå‘ */
        return (
          &lt;Lifecycle
              onMount=&#123;() =&gt; &#123;
              method(location);
            &#125;&#125;
              onUpdate=&#123;(self, prevProps) =&gt; &#123;
              const prevLocation = createLocation(prevProps.to);
              if (
                !locationsAreEqual(prevLocation, &#123;
                  ...location,
                  key: prevLocation.key
                &#125;)
              ) &#123;
                method(location);
              &#125; 
            &#125;&#125;
              to=&#123;to&#125;
          /&gt;
        );
      &#125;&#125;
    &lt;/RouterContext.Consumer&gt;
  );
&#125;
</code></pre>
<p>åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œè·¯ç”±è·³è½¬ï¼Œå½“åˆå§‹åŒ–çš„æ—¶å€™ï¼Œmountedæ‰§è¡Œpushæ–¹æ³•ï¼Œå½“ç»„ä»¶æ›´æ–°çš„æ—¶å€™ï¼Œå¦‚æœlocationä¸ç›¸ç­‰ã€‚åŒæ ·ä¼šæ‰§è¡Œhistoryæ–¹æ³•é‡å®šå‘ã€‚</p>
<h1 id="äº”ã€æ€»ç»“-æµç¨‹åˆ†æ"><a href="#äº”ã€æ€»ç»“-æµç¨‹åˆ†æ" class="headerlink" title="äº”ã€æ€»ç»“ + æµç¨‹åˆ†æ"></a>äº”ã€æ€»ç»“ + æµç¨‹åˆ†æ</h1><p><strong>æ€»ç»“</strong></p>
<p>historyæä¾›äº†æ ¸å¿ƒapiï¼Œå¦‚ç›‘å¬è·¯ç”±ï¼Œæ›´æ”¹è·¯ç”±çš„æ–¹æ³•ï¼Œå·²ç»ä¿å­˜è·¯ç”±çŠ¶æ€stateã€‚</p>
<p>react-routeræä¾›è·¯ç”±æ¸²æŸ“ç»„ä»¶ï¼Œè·¯ç”±å”¯ä¸€æ€§åŒ¹é…ç»„ä»¶ï¼Œé‡å®šå‘ç»„ä»¶ç­‰åŠŸèƒ½ç»„ä»¶ã€‚</p>
<p><strong>æµç¨‹åˆ†æ</strong></p>
<p><strong>å½“åœ°å€æ æ”¹å˜urlï¼Œç»„ä»¶çš„æ›´æ–°æ¸²æŸ“éƒ½ç»å†äº†ä»€ä¹ˆï¼ŸğŸ˜ŠğŸ˜ŠğŸ˜Š</strong><br>æ‹¿historyæ¨¡å¼åšå‚è€ƒã€‚å½“urlæ”¹å˜ï¼Œé¦–å…ˆè§¦å‘histoyï¼Œè°ƒç”¨äº‹ä»¶ç›‘å¬popstateäº‹ä»¶ï¼Œ è§¦å‘å›è°ƒå‡½æ•°handlePopStateï¼Œè§¦å‘historyä¸‹é¢çš„setstateæ–¹æ³•ï¼Œäº§ç”Ÿæ–°çš„locationå¯¹è±¡ï¼Œç„¶åé€šçŸ¥Routerç»„ä»¶æ›´æ–°locationå¹¶é€šè¿‡contextä¸Šä¸‹æ–‡ä¼ é€’ï¼Œswitché€šè¿‡ä¼ é€’çš„æ›´æ–°æµï¼ŒåŒ¹é…å‡ºç¬¦åˆçš„Routeç»„ä»¶æ¸²æŸ“ï¼Œæœ€åæœ‰Routeç»„ä»¶å–å‡ºcontextå†…å®¹ï¼Œä¼ é€’ç»™æ¸²æŸ“é¡µé¢ï¼Œæ¸²æŸ“æ›´æ–°ã€‚</p>
<p><strong>å½“æˆ‘ä»¬è°ƒç”¨history.pushæ–¹æ³•ï¼Œåˆ‡æ¢è·¯ç”±ï¼Œç»„ä»¶çš„æ›´æ–°æ¸²æŸ“åˆéƒ½ç»å†äº†ä»€ä¹ˆå‘¢ï¼Ÿ</strong><br>æˆ‘ä»¬è¿˜æ˜¯æ‹¿historyæ¨¡å¼ä½œä¸ºå‚è€ƒï¼Œå½“æˆ‘ä»¬è°ƒç”¨history.pushæ–¹æ³•ï¼Œé¦–å…ˆè°ƒç”¨historyçš„pushæ–¹æ³•ï¼Œé€šè¿‡history.pushStateæ¥æ”¹å˜å½“å‰urlï¼Œæ¥ä¸‹æ¥è§¦å‘historyä¸‹é¢çš„setStateæ–¹æ³•ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±å’Œä¸Šé¢ä¸€æ¨¡ä¸€æ ·äº†ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€è¯´äº†ã€‚</p>
<p><strong>æˆ‘ä»¬ç”¨ä¸€å¹…å›¾æ¥è¡¨ç¤ºå„ä¸ªè·¯ç”±ç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚</strong></p>
<p><img src="/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/img_2.png"></p>
<p>å¸Œæœ›è¯»è¿‡æ­¤ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œèƒ½å¤Ÿæ˜ç™½react-routerçš„æ•´ä¸ªæµç¨‹ï¼Œä»£ç é€»è¾‘ä¸æ˜¯å¾ˆéš¾ç†è§£ã€‚æ•´ä¸ªæµç¨‹æˆ‘ç»™å¤§å®¶åˆ†æäº†ä¸€éï¼Œå¸Œæœ›åŒå­¦ä»¬èƒ½ä¸»åŠ¨çœ‹ä¸€æ³¢æºç ï¼ŒæŠŠæ•´ä¸ªæµç¨‹ææ˜ç™½ã€‚çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…,ç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚</p>

  </div>
  <!--æ–‡æœ«ç»“æŸè¯­-->
  
    <div style="text-align:center;color: #ccc;font-size:24px;"> --- æœ¬æ–‡ç»“æŸ <i class="iconfont icon-heartbeat" style="font-size:24px;"></i> The End --- </div>
  
  <!--é¡µè„šå¹¿å‘Š-->
  
  <div class="mdui-divider"></div>
  
  <nav>
    
      <a rel="prev" class="post-nav-item mdui-float-left" href="/2022/03/22/react/react-redux%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/">
        <i class="iconfont icon-angle-left"></i>
        <span>react-reduxçš„æ ¸å¿ƒåŸç†</span>
      </a>
    
    
      <a rel="next" class="post-nav-item mdui-float-right" href="/2022/03/05/react/React-Router%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%8F%8A%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F%E5%88%86%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88/">
        <span>React-Routerçš„å®ç°åŸç†åŠå·¥ä½œæ–¹å¼åˆ†åˆ«æ˜¯ä»€ä¹ˆ</span>
        <i class="iconfont icon-angle-right"></i>
      </a>
    
  </nav>
</article>




  <div class="toc-button"  style="z-index: 100;">
    <button class="mdui-fab mdui-ripple mdui-color-teal" mdui-menu="{target: '#toc'}"><i class="iconfont icon-list"></i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item">
        <a href="/2022/03/22/react/react-router%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86/" id="toc-header" class="mdui-ripple">æ–‡ç« ç›®å½•</a>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%AD%A3%E7%A1%AE%E7%90%86%E8%A7%A3react-router"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€æ­£ç¡®ç†è§£react-router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%90%86%E8%A7%A3%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1. ç†è§£å•é¡µé¢åº”ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-react-router%E5%88%9D%E6%8E%A2%EF%BC%8C%E6%8F%AD%E9%9C%B2%E8%B7%AF%E7%94%B1%E5%8E%9F%E7%90%86%E9%9D%A2%E7%BA%B1"><span class="toc-number">1.2.</span> <span class="toc-text">2. react-routeråˆæ¢ï¼Œæ­éœ²è·¯ç”±åŸç†é¢çº±</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€å•é¡µé¢å®ç°æ ¸å¿ƒåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-history%E6%A8%A1%E5%BC%8F%E5%8E%9F%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">1. historyæ¨¡å¼åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-hash%E6%A8%A1%E5%BC%8F%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">2. hashæ¨¡å¼åŸç†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%90%86%E8%A7%A3-history-%E5%BA%93"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰ã€ç†è§£ history åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-createBrowserHistory"><span class="toc-number">3.0.1.</span> <span class="toc-text">1. createBrowserHistory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-createHashHistory"><span class="toc-number">3.0.2.</span> <span class="toc-text">2. createHashHistory</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E6%A0%B8%E5%BF%83api"><span class="toc-number">4.</span> <span class="toc-text">å››ã€ æ ¸å¿ƒapi</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Router-%E6%8E%A5%E6%94%B6location%E5%8F%98%E5%8C%96%EF%BC%8C%E6%B4%BE%E5%8F%91%E6%9B%B4%E6%96%B0%E6%B5%81"><span class="toc-number">4.1.</span> <span class="toc-text">1ã€Router-æ¥æ”¶locationå˜åŒ–ï¼Œæ´¾å‘æ›´æ–°æµ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Switch-%E5%8C%B9%E9%85%8D%E6%AD%A3%E7%A1%AE%E7%9A%84%E5%94%AF%E4%B8%80%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">4.2.</span> <span class="toc-text">2ã€Switch-åŒ¹é…æ­£ç¡®çš„å”¯ä¸€çš„è·¯ç”±</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Route-%E7%BB%84%E4%BB%B6%E9%A1%B5%E9%9D%A2%E6%89%BF%E8%BD%BD%E5%AE%B9%E5%99%A8"><span class="toc-number">4.3.</span> <span class="toc-text">3ã€Route-ç»„ä»¶é¡µé¢æ‰¿è½½å®¹å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Redirect-%E6%B2%A1%E6%9C%89%E7%AC%A6%E5%90%88%E7%9A%84%E8%B7%AF%E7%94%B1%EF%BC%8C%E9%82%A3%E4%B9%88%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">4.4.</span> <span class="toc-text">4ã€Redirect-æ²¡æœ‰ç¬¦åˆçš„è·¯ç”±ï¼Œé‚£ä¹ˆé‡å®šå‘</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">äº”ã€æ€»ç»“ + æµç¨‹åˆ†æ</span></a></li></ol>
      </li>
    </ul>
  </div>



    <div id="comment" class="mdui-card mdui-p-a-2 mdui-m-b-5">
      <div class="mdui-tab" mdui-tab>
        
          <a href="#comment-tab0" class="mdui-ripple">valine</a>
        
      </div>
      
        <div id="comment-tab0" class="mdui-p-a-2">
          <div id="vcomments"></div>
<script src="//cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var guest_info = ''.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1;
  });
  var notify = '' === 'true';
  var verify = '' === 'true';
  new Valine({
    el: '#vcomments',
    notify: notify,
    verify: verify,
    appId: 'K384DoBsTJo09tPYtLMxDJz1-gzGzoHsz',
    appKey: 'Bp5G6BLH11s6zkpTjHkvoG1g',
    placeholder: '',
    pageSize: '',
    avatar: '',
    lang: '',
    guest_info: guest_info
  });
</script>
        </div>
      
    </div>

  </main>
  <footer id="footer" class="mdui-text-center mdui-m-t-5 mdui-p-b-2 mdui-p-t-4 mdui-color-theme">
  <div class="mdui-container">
    <div class="mdui-row">
      
        <a href="https://beian.miit.gov.cn" rel="noopener" target="_blank"></a>
      
      <span>
        &copy; 2015 - 2022 
        
          <span style="color:#d9333f" class="iconfont icon-heart"></span>
        
        Dalu Kuankuan
      </span>
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span>Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span>Theme: <a href="https://github.com/kb1000fx/Meadow" rel="noopener" target="_blank">Meadow</a></span>
        </div>
      
    </div>
    <div class="mdui-row">
      
        <div class="mdui-col-xs-6 mdui-text-right">
          <span id="busuanzi_container_site_uv" style="display: none;"> <span class="iconfont icon-user"></span>æ€»è®¿å®¢é‡ <span id="busuanzi_value_site_uv"></span></span>
        </div>
        <div class="mdui-col-xs-6 mdui-text-left">
          <span id="busuanzi_container_site_pv" style="display: none;"> <span class="iconfont icon-eye"></span>æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv"></span></span>
        </div>
      
    </div>
 </div>
</footer>
  
  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-teal" style="z-index:100;"><i class="iconfont icon-arrowup"></i></button>
  
  

    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>




    
<script src="/js/mdui.min.v1.0.0.js"></script>




<script src="/js/meadow.js"></script>

</body>
</html >